---
layout: default
title: Diffusion-HIC
mathjax: true
description: An end-to-end diffusion generative model for heavy-ion collisions.
abstract: >
  Diffusion-HIC is an end-to-end diffusion generative model designed for ultra-relativistic heavy-ion collisions. 
  It leverages advanced diffusion model to simulate high-energy events with high precision and significant speed-up.
---

# Introduction

The multistage approach based on hydrodynamics has achieved remarkably success in modeling heavy-ion physics, providing an accurate description of experimental particle spectra as well as various signatures of collective flow, flow correlations, and fluctuations. However, traditional numerical simulations of hydrodynamics are challenged by recent high-precision measurements: to probe the finer details in the system via statistics-demanding observables, $10^9-10^{10}$ collisions events are commonly required. **As heavy-ion collision physics enters a high-precision era, theoretical modeling needs to evolve to meet growing computational demands.**

In this work, we introduce DiffHIC, a generative diffusion model designed to bridge this gap. **The model simulates ultra-relativistic heavy-ion collisions from end to end, taking initial entropy density profiles as input and producding two-dimensional final particle spectra.** By comparing observables derived from particle spectra generated by both traditional numerical simulations and our trained generative model, we demonstrate that DiffHIC not only accurately replicates integrated and differential observables but also effectively captures higher-order fluctuations and correlations. These results indicate that **DiffHIC successfully learns the intricate mapping from initial entropy density profiles to final particle spectra, governed by a set of nonlinear hydrodynamic and Boltzmann transport equations**. While preserving the fine details of the underlying physical processes, DiffHIC significantly accelerates end-to-end heavy-ion collision simulations. For example, **DiffHIC can simulate a single central collision event in just 0.1 seconds on a GeForce GTX 4090 GPU.($10^5$ times speed-up)**

# The hybrid model for heavy-ion collisions
![Hybrid model](./assets/imgs/hic.png)

$$
\begin{align}
\partial_\mu T^{\mu\nu} &= 0\\
P &= P(e)
\end{align}
$$

## Data preparations
![Data preparations](./assets/imgs/data.png)

# The diffusion generative model for heavy-ion collisions
Our task is to generate the final particle spectra conditioned by the initial entropy density profile  and the shear viscosity, a process is governed by hydrodynamic evolution and Boltzmann transport. We model it as a conditional distributions,

$$ 
p(\text{Particle Spectra} | \text{Initial entropy production}, \text{Physical parameters}).
$$

The diffusion model is born for learn unknown distributions, especially for high-dimensional data. In the forward process, the original data distribution is transformed into a known prior, by gradually injecting noise. Such a process is governed by a stochastic differential equation (SDE). A corresponding reverse-time SDE transforms the prior distribution back into the data dis-
tribution by gradually removing the noise.

![demo Diffusion](./assets/imgs/demoDiff.png)

Here is our trainging pipeline. The initial density profiles and corresponding particle spectra are concatenated channel-wise. The diffusion time steps $t$ and $\eta/s$ are encoded via a time-embedding and label-embedding layer, respectively, which are further added together. The input charged particle spectra are noised according to $\pmb{S}_t = \sqrt{\alpha_t} \pmb{S}_0 + \sqrt{1-\alpha_t} \pmb{\varepsilon}$. 

A noise-prediction network $\pmb{\varepsilon}_{\pmb\theta}(\pmb{S}_t, \pmb{I}, \eta/s, t)$ are used, aiming to minimize the mean squared error 

$$\|\boldsymbol{\varepsilon} - \boldsymbol{\varepsilon}_{\pmb\theta}\|^2.$$ 

Once we have a such trained scaled score function
$\pmb \varepsilon_{\pmb \theta} = -\sigma_t \pmb s_{\pmb \theta}$, the particle spectra can be generated from Gaussian noise by solving the reverse ODE. The DPM-Slover is used for sampling in this work.

![Workflow](./assets/imgs/workflow.png)
# Examples
The first row are the ground truth particle spectra and the second row are generated ones. We also label the collisons centralities in the figure.

![examples](./assets/imgs/example.png)

At eyes level, the generated model can reproduce the ground truth particle spectra accruately. However, for the scientific applications, the pixel level precision should be pursued. Thus, we need to evaluate the model in a physical way.

# Evaluations
{% raw %}
$$
{\pmb S}\equiv \frac{dN}{{d^2 {\pmb p}_T}} \sim \sum_{n=0} v_n(p_T) e^{i n (\phi_p-\Psi_n)} 
$$
{% endraw %}